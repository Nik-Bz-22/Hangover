{% extends "../main/base.html" %}
{% load static %}

{% block head %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
    <link rel="stylesheet" href="{% static 'CSS/RepoDetail.css' %}">
{% endblock head %}


{% block content %}
    <div id="workspace">
        <div class="sidebar no-select" id="repo-tree">
            <ul>
                {% include "analyzer/_helper/tree_node.html" with tree=file_tree current_path="" %}
            </ul>
        </div>

        <div class="code-box">
            <pre class="line-numbers" id="pre-code-box">
                <code id="code" >
                </code>
            </pre>
        </div>

        <div class="content">
            <h1>WorkSpace</h1>
            <form id="prompt-form" action="{% url 'api_analyze_repo' %}" method="post">
                {% csrf_token %}
                <textarea id="description"></textarea>
                <input type="hidden" name="selected_files" id="selected_files">
                <button id="submit-prompt">Send</button>
            </form>
            <ul id="questions">
                {% for question in  questions %}
                    <li class="question-wrapper" question-id="{{ question.id }}">
                        {{ question|safe }}
                    </li>
                {% endfor %}
            </ul>
        </div>
    </div>
{% endblock content %}


{% block script %}
    <script>
        const urlTokens = "{{ repository.url }}".split("/");
        const innerApiUrl = "{% url 'api_get_repo_content' repository.id %}";
        const questionDetailUrl = "{% url 'api_get_question' %}";
        const repoID = "{{ repository.id }}";
        const repo_owner = urlTokens.at(-2);
        const repo_name = urlTokens.at(-1);
    </script>
    <script src="{% static 'JavaScript/RepoDetail.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
{% endblock script %}
